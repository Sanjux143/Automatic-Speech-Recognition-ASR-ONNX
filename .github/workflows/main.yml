
Name: Build SenseVoice ONNX

on:
  workflow_dispatch:

jobs:
  export_job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install -U funasr modelscope torch torchaudio onnxruntime onnx numpy

      - name: Export SenseVoice Small
        run: |
          python -c "
          from funasr import AutoModel
          import os
          
          # Model load aur export logic
          model_id = 'iic/SenseVoiceSmall'
          output_dir = './SenseVoice_Export'
          
          model = AutoModel(model=model_id, device='cpu')
          
          # FunASR ka internal export function jo SenseVoice ke liye optimized hai
          # Isme quantization False rakha hai taki quality best rahe
          res = model.export(output_dir=output_dir, quantize=False)
          print('Export Completed Successfully!')
          "

      - name: Prepare Files for Mobile
        run: |
          # Sabse zaroori files ko root mein move kar rahe hain
          cp SenseVoice_Export/model.onnx ./SenseVoice.onnx
          cp SenseVoice_Export/tokens.json ./SenseVoice_tokens.json
          # Config file bhi le lo, kabhi-kabhi feature extraction mein kaam aati hai
          cp SenseVoice_Export/config.json ./config.json

      - name: Upload SenseVoice Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: SenseVoice_Mobile_Files
          path: |
            SenseVoice.onnx
            SenseVoice_tokens.json
            config.json
